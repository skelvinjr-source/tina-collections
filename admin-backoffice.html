<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Backoffice - Tina Collections</title>
    <link rel="stylesheet" href="admin-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- PDF Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <!-- Excel Export Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Login Screen -->
    <div id="admin-login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1>üõçÔ∏è Tina Collections</h1>
                <h2>Admin Backoffice</h2>
                <p class="login-subtitle">Secure Authentication</p>
            </div>
            <form id="admin-login-form" onsubmit="loginAdmin(event)">
                <div class="form-group">
                    <label for="admin-email">Email Address (Optional)</label>
                    <input type="email" id="admin-email" autocomplete="email" placeholder="admin@tinacollections.com">
                </div>
                <div class="form-group">
                    <label for="admin-password-input">Password</label>
                    <input type="password" id="admin-password-input" required autocomplete="current-password" placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary btn-large" id="login-btn">
                    <span id="login-btn-text">Login</span>
                    <span id="login-btn-spinner" style="display: none;">üîÑ Logging in...</span>
                </button>
            </form>
            <div class="login-footer">
                <p class="help-text">Secured by Supabase Authentication</p>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="admin-dashboard" style="display: none;">
        <!-- Sidebar Navigation -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <h2>üõçÔ∏è Tina Collections</h2>
                <p>Admin Panel</p>
            </div>
            <nav class="sidebar-nav">
                <a href="#" onclick="showSection('dashboard')" class="nav-item active" data-section="dashboard">
                    <span class="icon">üìä</span> Dashboard
                </a>
                <a href="#" onclick="showSection('products')" class="nav-item" data-section="products">
                    <span class="icon">üì¶</span> Products
                </a>
                <a href="#" onclick="showSection('orders')" class="nav-item" data-section="orders">
                    <span class="icon">üõí</span> Orders
                    <span class="badge" id="pending-orders-badge">0</span>
                </a>
                <a href="#" onclick="showSection('messages')" class="nav-item" data-section="messages">
                    <span class="icon">üí¨</span> Messages
                    <span class="badge" id="unread-messages-badge">0</span>
                </a>
                <a href="#" onclick="showSection('inventory')" class="nav-item" data-section="inventory">
                    <span class="icon">üìã</span> Inventory
                </a>
                <a href="#" onclick="showSection('analytics')" class="nav-item" data-section="analytics">
                    <span class="icon">üìà</span> Analytics
                </a>
                <a href="#" onclick="showSection('settings')" class="nav-item" data-section="settings">
                    <span class="icon">‚öôÔ∏è</span> Settings
                </a>
                <a href="#" onclick="showSection('backup')" class="nav-item" data-section="backup">
                    <span class="icon">üíæ</span> Backup
                </a>
            </nav>
            <div class="sidebar-footer">
                <button onclick="logoutAdmin()" class="btn btn-secondary btn-small">Logout</button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="admin-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <h1 id="section-title">Dashboard</h1>
                <div class="top-bar-actions">
                    <button onclick="refreshCurrentSection()" class="btn btn-secondary">üîÑ Refresh</button>
                    <a href="index.html" class="btn btn-primary" target="_blank">View Store</a>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="section-dashboard" class="content-section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <h3>Total Revenue</h3>
                            <p class="stat-value">L$<span id="stat-revenue">0.00</span></p>
                            <span class="stat-change positive">+0% from last month</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üõí</div>
                        <div class="stat-info">
                            <h3>Total Orders</h3>
                            <p class="stat-value"><span id="stat-orders">0</span></p>
                            <span class="stat-change positive">+0% from last month</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì¶</div>
                        <div class="stat-info">
                            <h3>Products</h3>
                            <p class="stat-value"><span id="stat-products">0</span></p>
                            <span class="stat-change">Active items</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-info">
                            <h3>Pending Orders</h3>
                            <p class="stat-value"><span id="stat-pending">0</span></p>
                            <span class="stat-change warning">Needs attention</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Recent Orders</h3>
                        <div id="recent-orders-list" class="simple-list">
                            <p class="loading">Loading...</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Sales Chart (Last 7 Days)</h3>
                        <canvas id="sales-chart"></canvas>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3>Top Selling Products</h3>
                        <div id="top-products-list" class="simple-list">
                            <p class="loading">Loading...</p>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3>Low Stock Alert</h3>
                        <div id="low-stock-list" class="simple-list">
                            <p class="loading">Loading...</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="section-products" class="content-section">
                <div class="section-header">
                    <button onclick="openAddProductModal()" class="btn btn-primary">+ Add New Product</button>
                    <div class="search-box">
                        <input type="text" id="product-search" placeholder="Search products..." onkeyup="searchProducts()">
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <tr><td colspan="7" class="loading">Loading products...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="section-orders" class="content-section">
                <div class="section-header">
                    <div class="filter-group">
                        <select id="order-status-filter" onchange="filterOrders()">
                            <option value="all">All Orders</option>
                            <option value="pending">Pending</option>
                            <option value="processing">Processing</option>
                            <option value="shipped">Shipped</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="search-box">
                        <input type="text" id="order-search" placeholder="Search orders..." onkeyup="searchOrders()">
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Phone</th>
                                <th>Total</th>
                                <th>Payment</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <tr><td colspan="8" class="loading">Loading orders...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Messages Section -->
            <section id="section-messages" class="content-section">
                <div class="section-header">
                    <div class="filter-group">
                        <select id="message-status-filter" onchange="filterMessages()">
                            <option value="all">All Messages</option>
                            <option value="unread">Unread</option>
                            <option value="read">Read</option>
                            <option value="replied">Replied</option>
                        </select>
                    </div>
                </div>
                <div id="messages-list-container">
                    <p class="loading">Loading messages...</p>
                </div>
            </section>

            <!-- Inventory Section -->
            <section id="section-inventory" class="content-section">
                <div class="section-header">
                    <button onclick="openStockAdjustmentModal()" class="btn btn-primary">+ Stock Adjustment</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Current Stock</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-table-body">
                            <tr><td colspan="5" class="loading">Loading inventory...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="section-analytics" class="content-section">
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Revenue Trend</h3>
                        <canvas id="revenue-chart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>Orders by Status</h3>
                        <canvas id="orders-status-chart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>Top Categories</h3>
                        <canvas id="categories-chart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>Payment Methods</h3>
                        <canvas id="payment-methods-chart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="section-settings" class="content-section">
                <div class="settings-container">
                    <div class="settings-card">
                        <h3>Business Information</h3>
                        <form id="business-settings-form" onsubmit="saveBusinessSettings(event)">
                            <div class="form-group">
                                <label>Business Name</label>
                                <input type="text" id="setting-business-name" required>
                            </div>
                            <div class="form-group">
                                <label>Business Email</label>
                                <input type="email" id="setting-business-email" required>
                            </div>
                            <div class="form-group">
                                <label>Business Phone</label>
                                <input type="tel" id="setting-business-phone" required>
                            </div>
                            <div class="form-group">
                                <label>Delivery Fee (L$)</label>
                                <input type="number" step="0.01" id="setting-delivery-fee" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </form>
                    </div>
                    <div class="settings-card">
                        <h3>Change Password</h3>
                        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">Update your admin account password</p>
                        <form id="password-change-form" onsubmit="changePassword(event)">
                            <div class="form-group">
                                <label>New Password</label>
                                <input type="password" id="new-password" required minlength="6" placeholder="Enter new password">
                                <small style="color: #666;">Minimum 6 characters</small>
                            </div>
                            <div class="form-group">
                                <label>Confirm New Password</label>
                                <input type="password" id="confirm-password" required minlength="6" placeholder="Confirm new password">
                            </div>
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Backup Section -->
            <section id="section-backup" class="content-section">
                <div class="backup-container">
                    <div class="backup-card">
                        <h3>üì• Export All Data</h3>
                        <p>Complete database backup with all records</p>
                        <div class="export-format-group">
                            <button onclick="exportData('all', 'json')" class="btn btn-secondary">
                                üìÑ JSON
                            </button>
                            <button onclick="exportData('all', 'pdf')" class="btn btn-secondary">
                                üìë PDF
                            </button>
                            <button onclick="exportData('all', 'excel')" class="btn btn-secondary">
                                üìä Excel
                            </button>
                        </div>
                    </div>

                    <div class="backup-card">
                        <h3>üõí Export Orders</h3>
                        <p>All customer orders with details</p>
                        <div class="export-format-group">
                            <button onclick="exportData('orders', 'json')" class="btn btn-secondary">
                                üìÑ JSON
                            </button>
                            <button onclick="exportData('orders', 'pdf')" class="btn btn-secondary">
                                üìë PDF
                            </button>
                            <button onclick="exportData('orders', 'excel')" class="btn btn-secondary">
                                üìä Excel
                            </button>
                        </div>
                    </div>

                    <div class="backup-card">
                        <h3>üì¶ Export Products</h3>
                        <p>Product catalog with pricing and stock</p>
                        <div class="export-format-group">
                            <button onclick="exportData('products', 'json')" class="btn btn-secondary">
                                üìÑ JSON
                            </button>
                            <button onclick="exportData('products', 'pdf')" class="btn btn-secondary">
                                üìë PDF
                            </button>
                            <button onclick="exportData('products', 'excel')" class="btn btn-secondary">
                                üìä Excel
                            </button>
                        </div>
                    </div>

                    <div class="backup-card">
                        <h3>üí¨ Export Messages</h3>
                        <p>Customer messages and inquiries</p>
                        <div class="export-format-group">
                            <button onclick="exportData('messages', 'json')" class="btn btn-secondary">
                                üìÑ JSON
                            </button>
                            <button onclick="exportData('messages', 'pdf')" class="btn btn-secondary">
                                üìë PDF
                            </button>
                            <button onclick="exportData('messages', 'excel')" class="btn btn-secondary">
                                üìä Excel
                            </button>
                        </div>
                    </div>

                    <div class="backup-card">
                        <h3>üì§ Import Products</h3>
                        <p>Upload a file to bulk import products</p>
                        <input type="file" id="import-file" accept=".csv,.json,.xlsx" style="display: none;" onchange="handleImportFile(event)">
                        <button onclick="document.getElementById('import-file').click()" class="btn btn-primary">Choose File</button>
                        <p class="help-text">Supported formats: CSV, JSON, Excel</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="product-modal-title">Add New Product</h2>
                <button onclick="closeProductModal()" class="modal-close">&times;</button>
            </div>
            <form id="product-form" onsubmit="saveProduct(event)">
                <input type="hidden" id="product-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select id="product-category" required>
                            <option value="shirt">Shirt</option>
                            <option value="hoodie">Hoodie</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Price (L$) *</label>
                        <input type="number" step="0.01" id="product-price" required>
                    </div>
                    <div class="form-group">
                        <label>Stock Quantity *</label>
                        <input type="number" id="product-stock" required value="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="product-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Image URL</label>
                    <input type="url" id="product-image">
                </div>
                <div class="form-group">
                    <label>Available Sizes (comma-separated)</label>
                    <input type="text" id="product-sizes" value="S,M,L,XL,XXL">
                </div>
                <div class="form-group">
                    <label>Available Colors (comma-separated)</label>
                    <input type="text" id="product-colors" value="Black,White,Red,Blue">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="product-in-stock" checked> In Stock
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="closeProductModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="order-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Order Details</h2>
                <button onclick="closeOrderModal()" class="modal-close">&times;</button>
            </div>
            <div id="order-details-content">
                <p class="loading">Loading...</p>
            </div>
        </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div id="stock-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Stock Adjustment</h2>
                <button onclick="closeStockModal()" class="modal-close">&times;</button>
            </div>
            <form id="stock-form" onsubmit="saveStockAdjustment(event)">
                <div class="form-group">
                    <label>Select Product *</label>
                    <select id="stock-product-id" required>
                        <option value="">Choose a product...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Adjustment Type *</label>
                    <select id="stock-adjustment-type" required onchange="updateStockQuantityLabel()">
                        <option value="add">Add Stock</option>
                        <option value="remove">Remove Stock</option>
                    </select>
                </div>
                <div class="form-group">
                    <label id="stock-quantity-label">Quantity to Add *</label>
                    <input type="number" id="stock-quantity" required min="1">
                </div>
                <div class="form-group">
                    <label>Reason</label>
                    <select id="stock-reason">
                        <option value="restock">Restock</option>
                        <option value="return">Customer Return</option>
                        <option value="damaged">Damaged</option>
                        <option value="sale">Manual Sale</option>
                        <option value="adjustment">Inventory Adjustment</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="stock-notes" rows="2"></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="closeStockModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Adjustment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="supabase-config.js"></script>
    <script src="admin-backoffice.js"></script>
</body>
</html>
